theme_bw()
install.packages("XML")
install.packages("lubridate")
### script based on code by Erik Gahner Larsen, @erikgahner
library(XML)
#pull in data
url <- "http://en.wikipedia.org/wiki/Opinion_polling_for_the_next_Danish_general_election"
polls <- readHTMLTable(url)
#clean up
polls <- polls[[1]]
polls <- polls[-1,1:10]
names(polls) <- c("Institut", "date","Venstre","Socialdemokraterne","DF","Radikale","SF","Enhedslisten","LA","Konservative")
#get full date
breakpoints<-c(which(is.na(polls$date)),nrow(polls)-1)
yearsindata<-c(2014,2013,2012,2011)
polls$fulldate<-NA
for (i in 4:1){
polls$fulldate[0:breakpoints[i]]<-paste(polls$date[0:breakpoints[i]],", ",yearsindata[i],sep="")
}
polls$fulldate[nrow(polls)]<-polls$date[nrow(polls)]
polls<-polls[!is.na(polls$date),]
polls$fulldate[nrow(polls)]<-as.character(polls$date[nrow(polls)])
require(lubridate)
polls$fulldate<-mdy(tolower(polls$fulldate),locale="English")
#clean up house names
polls$Institut <- gsub("\\[|1|2|3|4|5|6|\\]", "", polls$Institut)
polls$Institut <- gsub("DR", "Epinion", polls$Institut)
#calculate blocs
names(polls)
polls$redbloc<-as.numeric(as.character((polls[,4])))+as.numeric(as.character((polls[,6])))+as.numeric(as.character((polls[,7])))+as.numeric(as.character((polls[,8])))
polls$bluebloc<-as.numeric(as.character((polls[,3])))+as.numeric(as.character((polls[,5])))+as.numeric(as.character((polls[,9])))+as.numeric(as.character((polls[,10])))
polls$blocdiff<-polls$bluebloc-polls$redbloc
#plot
require(ggplot2)
ggplot(polls,aes(x=fulldate,y=blocdiff)) +
geom_point(alpha=.8) +
geom_smooth(method="loess",span=.2,level=.90) +
geom_smooth(method="loess",span=.2,level=.95) +
geom_smooth(method="loess",span=.2,level=.99,color="black") +
xlab("") +
ylab("Blue bloc advantage, percentage points") +
geom_hline(yintercept=0,linetype=2) +
theme_bw()
#house effects?
anova(lm(blocdiff~factor(Institut),data=polls))
houseeffects<-as.data.frame(summary(lm(blocdiff~factor(Institut),data=polls))$coefficients[2:8,1:2])
names(houseeffects)<-c("est","se")
houseeffects$house<-as.character(levels(as.factor(polls$Institut))[2:8])
bdmean<-mean(polls$blocdiff)
t95<-1.96
ggplot(houseeffects,aes(x=est-bdmean,y=reorder(house,est))) +
geom_point() +
geom_errorbarh(aes(xmin=est-t95*se-bdmean,xmax=est+t95*se-bdmean,height=0)) +
geom_vline(xintercept=0,linetype=2) +
theme_bw() +
xlab("") +
ylab("")
View(houseeffects)
bdmean<-mean(polls$blocdiff)
View(polls)
bdmean<-mean(polls$blocdiff,na.rm=T)
t95<-1.96
ggplot(houseeffects,aes(x=est-bdmean,y=reorder(house,est))) +
geom_point() +
geom_errorbarh(aes(xmin=est-t95*se-bdmean,xmax=est+t95*se-bdmean,height=0)) +
geom_vline(xintercept=0,linetype=2) +
theme_bw() +
xlab("") +
ylab("")
readLines("/Users/frederikhjorth/Downloads/cses4/cses4.dat",n=10)
trust<-c(4.7,5.3,4.1,6.9,7,5.4,6.5,6.1,4.1,4.4)
barplot(trust)
inst<-c("Kommunalbestyrelsen","Off. administration","Politikerne","Politiet","Domstolene","Banksektoren","Sygehuse","Folkeskolen","Medierne","EU")
df<-data.frame(inst,trust)
barplot(df)
require(ggplot2)
ggplot(df,aes(x=trust,y=inst)) +
geom_point()
ggplot(df,aes(x=trust,y=inst)) +
geom_point() +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
theme_bw()
df$upper<-df$trust+2/sqrt(1451)
df$lower<-df$trust-2/sqrt(1451)
df$lower<-df$trust-2/sqrt(1451)
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower)) +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower),width=0) +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower),size=0) +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower),size=1) +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower,width=0),size=1) +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower),width=0) +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower),height=0) +
theme_bw()
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower),height=0) +
theme_bw() +
xlab("") +
ylab("")
trust<-c(4.7,5.3,4.1,6.9,7,5.4,6.5,6.1,4.1,4.4)
inst<-c("Kommunalbestyrelsen","Off. administration","Politikerne","Politiet","Domstolene","Banksektoren","Sygehuse","Folkeskolen","Medierne","EU")
df<-data.frame(inst,trust)
df$upper<-df$trust+1.96*2/sqrt(1451)
df$lower<-df$trust-1.96*2/sqrt(1451)
require(ggplot2)
ggplot(df,aes(x=trust,y=reorder(inst,trust))) +
geom_point() +
geom_errorbarh(aes(xmin=upper,xmax=lower),height=0) +
theme_bw() +
xlab("") +
ylab("")
setwd("~/GitHub/comppoldata")
ms<-read.csv(file="msdata.csv")
dkukfrde<-c(3,5,6,17)
ms<-ms[ms$v001x %in% dkukfrde,]
#country
class(ms$v001x)
ms$cntry<-as.factor(ms$v001x)
levels(ms$cntry)<-c("Denmark","France","Germany","UK")
#eff no of parties
summary(ms$v043y)
ms$effnop<-ms$v043y
table(ms$effnop)
#date
table(ms$v004x)
ms$date0<-paste(substr(ms$v004x,5,6),substr(ms$v004x,3,4),as.numeric(substr(ms$v004x,1,2))+1900,sep="-")
require(lubridate)
ms$fulldate<-dmy(ms$date0)
require(ggplot2)
pdf(file="effnop.pdf",width=10,height=4)
ggplot(ms,aes(x=fulldate,y=effnop,group=cntry)) +
geom_line(aes(color=cntry)) +
theme_bw()
dev.off()
#minority?
table(ms$v058y2)
ms$minority<-factor(ifelse(ms$v058y2==1,1,0))
pdf(file="minority.pdf",width=10,height=4)
ggplot(ms,aes(x=fulldate,fill=minority)) +
geom_bar() +
facet_grid(cntry~.) +
theme_bw()
dev.off()
setwd("~/GitHub/comppoldata")
erd<-read.csv(file="erd.csv")
dkukfrde<-c(3,5,6,17)
erd<-erd[erd$v001e %in% dkukfrde,]
#country
class(erd$v001e)
erd$cntry<-as.factor(erd$v001e)
levels(erd$cntry)<-c("Denmark","France","Germany","UK")
summary(erd$v309e)
erd$effnop<-erd$v309e
table(erd$effnop)
table(erd$v004e)
erd$fulldate<-ymd(erd$v004e)
table(erd$fulldate)
ggplot(erd,aes(x=fulldate,y=effnop,group=cntry)) +
geom_line(aes(color=cntry)) +
theme_bw()
require(lubridate)
erd$fulldate<-ymd(erd$v004e)
table(erd$fulldate)
table(erd$v329e)
erd$minority<-factor(ifelse(erd$v329e==1,1,0))
ggplot(erd,aes(x=fulldate,fill=minority)) +
geom_bar() +
facet_grid(cntry~.) +
theme_bw()
pdf(file="minority.pdf",width=10,height=4)
ggplot(erd,aes(x=fulldate,fill=minority)) +
geom_bar() +
facet_grid(cntry~.) +
theme_bw()
dev.off()
ggplot(erd,aes(x=fulldate,y=v407e,group=cntry)) +
geom_line(aes(color=cntry)) +
theme_bw()
cor.test(erd$v320e,erd$v330e)
plot(erd$v320e,erd$v330e)
summary(lm(v330e~v320e,factor(cntry),data=erd))
summary(lm(v330e~v320e+factor(cntry),data=erd))
erd0<-read.csv(file="erd.csv")
erd<-erd0[erd0$v001e %in% dkukfrde,]
summary(lm(v330e~v320e+factor(cntry),data=erd0))
summary(lm(v330e~v320e+factor(v001e),data=erd0))
plot(erd0$v320e,erd0$v330e)
ggplot(erd0,aes(x=erd0$v320e,y=erd0$v330e)) +
geom_jitter(alpha=.6) +
theme_bw()
ggplot(erd0,aes(x=erd0$v320e,y=erd0$v330e)) +
geom_smooth(method="loess") +
geom_jitter(alpha=.6) +
theme_bw()
ggplot(erd0,aes(x=erd0$v320e,y=erd0$v330e)) +
geom_smooth(method="loess") +
geom_jitter(alpha=.6) +
xlab("No. of cabinet parties") +
ylab("No. of ministers") +
theme_bw()
pdf(file="cabsize.pdf",width=10,height=4)
ggplot(erd0,aes(x=erd0$v320e,y=erd0$v330e)) +
geom_smooth(method="loess") +
geom_jitter(alpha=.6) +
xlab("No. of cabinet parties") +
ylab("No. of ministers") +
theme_bw()
dev.off()
pdf(file="cabsize.pdf",width=8,height=4)
ggplot(erd0,aes(x=erd0$v320e,y=erd0$v330e)) +
geom_smooth(method="loess") +
geom_jitter(alpha=.6) +
xlab("No. of cabinet parties") +
ylab("No. of ministers") +
theme_bw()
dev.off()
ggplot(erd,aes(x=fulldate,y=v602e)) +
geom_bar() +
facet_grid(cntry~.) +
theme_bw()
ggplot(erd,aes(x=fulldate,y=v602e)) +
geom_bar() +
#  facet_grid(cntry~.) +
theme_bw()
ggplot(erd,aes(x=fulldate,y=v407e,group=cntry)) +
geom_line(aes(color=cntry)) +
theme_bw()
setwd("~/GitHub/comppoldata")
ms<-read.csv(file="msdata.csv")
erd0<-read.csv(file="erd.csv")
dkukfrde<-c(3,5,6,17)
erd<-erd0[erd0$v001e %in% dkukfrde,]
#country
class(erd$v001e)
erd$cntry<-as.factor(erd$v001e)
levels(erd$cntry)<-c("Denmark","France","Germany","UK")
#eff no of parties
summary(erd$v309e)
erd$effnop<-erd$v309e
table(erd$effnop)
#date
table(erd$v004e)
#erd$date0<-paste(substr(erd$v004x,5,6),substr(erd$v004x,3,4),as.numeric(substr(erd$v004x,1,2))+1900,sep="-")
require(lubridate)
erd$fulldate<-ymd(erd$v004e)
table(erd$fulldate)
require(ggplot2)
pdf(file="effnop.pdf",width=10,height=4)
ggplot(erd,aes(x=fulldate,y=effnop,group=cntry)) +
geom_line(aes(color=cntry)) +
theme_bw()
dev.off()
#minority?
table(erd$v329e)
erd$minority<-factor(ifelse(erd$v329e==1,1,0))
pdf(file="minority.pdf",width=10,height=4)
ggplot(erd,aes(x=fulldate,fill=minority)) +
geom_bar() +
facet_grid(cntry~.) +
theme_bw()
dev.off()
ggplot(erd,aes(x=fulldate,y=v407e,group=cntry)) +
geom_line(aes(color=cntry)) +
theme_bw()
ggplot(erd,aes(x=fulldate,y=v602e)) +
geom_bar() +
#  facet_grid(cntry~.) +
theme_bw()
ggplot(erd,aes(x=fulldate,y=v602e)) +
geom_bar(stat="identity") +
#  facet_grid(cntry~.) +
theme_bw()
ggplot(erd,aes(x=fulldate,y=v602e)) +
geom_bar(stat="identity") +
facet_grid(cntry~.) +
theme_bw()
table(erd$v602e)
erd$reldur<-ifelse(erd$v602e<2,erd$v602e,NA)
ggplot(erd,aes(x=fulldate,y=reldur)) +
geom_bar(stat="identity") +
facet_grid(cntry~.) +
theme_bw()
class(erd$reldur)
summary(erd$reldur)
ggplot(erd,aes(x=fulldate,y=reldur)) +
geom_bar(stat="identity",color="black") +
facet_grid(cntry~.) +
theme_bw()
pdf(file="duration.pdf",width=8,height=4)
ggplot(erd,aes(x=fulldate,y=reldur)) +
geom_bar(stat="identity",color="black") +
facet_grid(cntry~.) +
theme_bw()
dev.off()
summary(lm(reldur~minority,data=erd))
summary(durmodel<-lm(reldur~minority,data=erd))
require(stargazer)
stargazer(durmodel)
stargazer(durmodel,style="apsr")
?stargazer
stargazer(durmodel,style="apsr",align=T)
ggplot(erd,aes(x=minority,y=reldur)) +
geom_jitter(alpha=.8)
erd$minority<-0
erd$minority[erd$v329e==1]<-1
erd$minority<-factor(erd$minority)
ggplot(erd,aes(x=fulldate,fill=minority)) +
geom_bar() +
facet_grid(cntry~.) +
theme_bw()
ggplot(erd,aes(x=minority,y=reldur)) +
geom_jitter(alpha=.8)
erd$minority<-factor(ifelse(erd$v329e==1,1,0))
ggplot(erd,aes(x=minority,y=reldur)) +
geom_jitter(alpha=.8) +
theme_bw()
ggplot(erd,aes(x=minority,y=reldur)) +
geom_bar(stat="mean") +
theme_bw()
?geom_bar
summary(lm(v330e~v320e+I(v320e^2)+factor(v001e),data=erd0))
summary(lm(v330e~v320e+factor(v001e),data=erd0))
summary(lm(v330e~v320e,data=erd0))
summary(cabsizemodel<-lm(v330e~v320e,data=erd0))
stargazer(cabsizemodel,style="apsr",align=T)
ggplot(erd,aes(x=fulldate,y=reldur)) +
geom_bar(stat="identity",color="black") +
facet_grid(cntry~.) +
theme_bw()
View(erd)
erd$reldur<-ifelse(erd$v602e<2,erd$v602e,NA)
ggplot(erd,aes(x=fulldate,y=reldur)) +
geom_bar(stat="identity",color="black") +
facet_grid(cntry~.) +
theme_bw()
erd$reldur[erd$cntry=="Denmark"]
View(erd)
View(erd[erd$cntry=="Denmark",120:206])
erd$reldur<-ifelse(erd$v603e<2,erd$v603e,NA)
ggplot(erd,aes(x=fulldate,y=reldur)) +
geom_bar(stat="identity",color="black") +
facet_grid(cntry~.) +
theme_bw()
pdf(file="duration.pdf",width=8,height=4)
ggplot(erd,aes(x=fulldate,y=reldur)) +
geom_bar(stat="identity",color="black") +
facet_grid(cntry~.) +
theme_bw()
dev.off()
table(erd$v600e)
ggplot(erd,aes(x=cntry,y=v600e)) +
geom_violin()
ggplot(erd,aes(x=fulldate,y=v600e)) +
geom_point()
ggplot(erd,aes(x=fulldate,y=v600e,color=cntry)) +
geom_point()
ggplot(erd,aes(x=fulldate,y=v600e,color=cntry)) +
geom_line()
ggplot(erd,aes(x=fulldate,y=v600e,color=cntry)) +
geom_line() +
theme_bw()
ggplot(erd,aes(x=fulldate,y=v600e,color=cntry)) +
geom_point() +
theme_bw()
ggplot(erd,aes(x=fulldate,y=v600e,color=cntry)) +
geom_point() +
geom_smooth(method="lowess") +
theme_bw()
table(erd$v705e)
erd$unempchange<-ifelse(erd$v705e<100,erd$v705e,NA)-ifelse(erd$v703e<100,erd$v703e,NA)
setwd("~/GitHub/comppoldata")
ms<-read.csv(file="msdata.csv")
erd0<-read.csv(file="erd.csv")
#country
class(erd$v001e)
erd$cntry<-as.factor(erd$v001e)
levels(erd$cntry)<-c("Denmark","France","Germany","UK")
#eff no of parties
summary(erd$v309e)
erd$effnop<-erd$v309e
table(erd$effnop)
#date
table(erd$v004e)
#erd$date0<-paste(substr(erd$v004x,5,6),substr(erd$v004x,3,4),as.numeric(substr(erd$v004x,1,2))+1900,sep="-")
require(lubridate)
erd$fulldate<-ymd(erd$v004e)
table(erd$fulldate)
#unempchange
erd$unempchange<-ifelse(erd$v705e<100,erd$v705e,NA)-ifelse(erd$v703e<100,erd$v703e,NA)
#minority?
table(erd$v329e)
erd$minority<-factor(ifelse(erd$v329e==1,1,0))
#govt duration
erd$reldur<-ifelse(erd$v603e<2,erd$v603e,NA)
dkukfrde<-c(3,5,6,17)
erd0<-erd
erd<-erd0[erd0$v001e %in% dkukfrde,]
ggplot(erd,aes(x=unempchange,y=reldur)) +
geom_jitter() +
theme_bw()
ggplot(erd,aes(x=unempchange,y=reldur)) +
geom_jitter() +
geom_smooth() +
theme_bw()
ggplot(erd,aes(x=unempchange,y=reldur)) +
geom_jitter() +
geom_smooth(method="lm") +
theme_bw()
setwd("~/GitHub/comppoldata")
ms<-read.csv(file="msdata.csv")
erd0<-read.csv(file="erd.csv")
#country
class(erd$v001e)
erd$cntry<-as.factor(erd$v001e)
levels(erd$cntry)<-c("Denmark","France","Germany","UK")
#eff no of parties
summary(erd$v309e)
erd$effnop<-erd$v309e
table(erd$effnop)
#date
table(erd$v004e)
#erd$date0<-paste(substr(erd$v004x,5,6),substr(erd$v004x,3,4),as.numeric(substr(erd$v004x,1,2))+1900,sep="-")
require(lubridate)
erd$fulldate<-ymd(erd$v004e)
table(erd$fulldate)
#unempchange
erd$unempchange<-ifelse(erd$v705e<100,erd$v705e,NA)-ifelse(erd$v703e<100,erd$v703e,NA)
#minority?
table(erd$v329e)
erd$minority<-factor(ifelse(erd$v329e==1,1,0))
#govt duration
erd$reldur<-ifelse(erd$v603e<2,erd$v603e,NA)
dkukfrde<-c(3,5,6,17)
erd0<-erd
setwd("~/GitHub/comppoldata")
ms<-read.csv(file="msdata.csv")
erd<-read.csv(file="erd.csv")
#country
class(erd$v001e)
erd$cntry<-as.factor(erd$v001e)
levels(erd$cntry)<-c("Denmark","France","Germany","UK")
#eff no of parties
summary(erd$v309e)
erd$effnop<-erd$v309e
table(erd$effnop)
#date
table(erd$v004e)
#erd$date0<-paste(substr(erd$v004x,5,6),substr(erd$v004x,3,4),as.numeric(substr(erd$v004x,1,2))+1900,sep="-")
require(lubridate)
erd$fulldate<-ymd(erd$v004e)
table(erd$fulldate)
#unempchange
erd$unempchange<-ifelse(erd$v705e<100,erd$v705e,NA)-ifelse(erd$v703e<100,erd$v703e,NA)
#minority?
table(erd$v329e)
erd$minority<-factor(ifelse(erd$v329e==1,1,0))
#govt duration
erd$reldur<-ifelse(erd$v603e<2,erd$v603e,NA)
dkukfrde<-c(3,5,6,17)
erd0<-erd
erd<-erd0[erd0$v001e %in% dkukfrde,]
ggplot(erd0,aes(x=fulldate,y=v600e,color=cntry)) +
geom_point() +
geom_smooth(method="lowess") +
theme_bw()
ggplot(erd,aes(x=unempchange,y=reldur)) +
geom_jitter() +
geom_smooth(method="lm") +
theme_bw()
ggplot(erd0,aes(x=unempchange,y=reldur)) +
geom_jitter() +
geom_smooth(method="lm") +
theme_bw()
summary(lm(reldur~unempchange,data=erd0))
pdf(file="unempdur.pdf",width=8,height=4)
ggplot(erd0,aes(x=unempchange,y=reldur)) +
geom_jitter() +
geom_smooth(method="lm") +
theme_bw()
dev.off()
ggplot(erd0,aes(x=unempchange,y=reldur)) +
geom_jitter(alpha=.8) +
geom_smooth(method="lm") +
theme_bw()
pdf(file="unempdur.pdf",width=8,height=4)
ggplot(erd0,aes(x=unempchange,y=reldur)) +
geom_jitter(alpha=.5) +
geom_smooth(method="lm") +
theme_bw()
dev.off()
